### 아두이노 마이크로컨트롤러

![아두이노 Uno R3](attachment:9f10df1d-54cc-47fa-b51d-19919f0ae256:image.png)

아두이노 Uno R3

기능 및 사양

- MCU: ATmega328P (8-bit AVR)
- 작동 전압: 5V
- 입력 전압 (권장): 7–12V
- 디지털 I/O 핀: 14개 (이 중 6개 PWM 출력 가능)
- 아날로그 입력 핀: 6개
- 클럭 속도: 16MHz
- 플래시 메모리: 32KB (부트로더에 0.5KB 사용)
- SRAM: 2KB
- EEPROM: 1KB
- 통신: UART, SPI, I2C 지원
- USB 포트: Type-B
- 아두이노 부품 번호: A000066

![아두이노 Uno R4 Minima](attachment:74d187a3-774b-4e49-ae4e-a29fca8517a8:image.png)

아두이노 Uno R4 Minima

기능 및 사양

- MCU: Renesas RA4M1 (32-bit ARM Cortex-M4)
- 작동 전압: 5V
- 입력 전압 범위: 6–24V
- 디지털 I/O 핀: 14개 (PWM 포함)
- 아날로그 입력 핀: 6개
- 클럭 속도: 48MHz
- 플래시 메모리: 256KB
- SRAM: 32KB
- 통신: UART, SPI, I2C, CAN Bus 지원
- USB 포트: USB-C (프로그래밍 및 전원)
- 기타 기능:
    - HID 장치 지원 (마우스/키보드 에뮬레이션 가능)
    - DAC (12비트)
    - 연산 증폭기 내장
    - 개선된 전원 섹션 (VIN 최대 24V 입력 가능)

| 항목 | Uno R3 | Uno R4 Minima |
| --- | --- | --- |
| 칩 종류 | ATmega328P (8비트) | RA4M1 (32비트) |
| 속도 | 16MHz | 48MHz |
| 메모리 | 32KB 플래시 / 2KB SRAM | 256KB 플래시 / 32KB SRAM |
| 통신 | 기본적인 UART, SPI, I2C | 추가로 CAN, HID 가능 |
| 입력 전압 | 7–12V | 6–24V |
| USB 포트 | USB-B | USB-C |
| 기타 | 기본적인 기능 | 고급 기능들(DAC, 연산 증폭기 등) |

### 아두이노 부트로더

- 부트로더 (Bootloader)는 ‘부팅을 하기위한 프로그램’을 불러오는 프로그램이다. 컴퓨터로 예를 들면, 운영체제(OS)를 불러오기 위한 프로그램이다.
- 아두이노 Uno R3의 경우에는 32KB의 플래시 메모리를 가지고 있으며, 이 안에 아두이노 통합개발환경을 원활하게 사용하기 위한 프로그램이 들어있다. 부트로드는 이 프로그램을 실행시키기 위해 존재하며, 부트로드가 고장날경우 업로드 과정에서 오류가 발생할 수 있다.
- ※ 부트로더 재설치 참고 URL ※
    
    [AVR Studio와 ISP업로더를 통한 부트로더 재설치](http://blog.naver.com/roboholic84/220814909546)
    
    [아두이노 우노로 아두이노 보드 부트로더 재설치](http://blog.naver.com/roboholic84/220323706815)
    
    [아두이노 메가로 아두이노 보드 부트로더 재설치](http://blog.naver.com/roboholic84/10181842375)
    

### 아두이노 펌웨어

- 펌웨어
    - MCU (마이크로컨트롤러) 안에서 동작하는 프로그램.
    - 하드웨어(보드)가 어떤 식으로 동작해야하는지를 알려주는 소프트웨어.

- 일반적으로 펌웨어를 개발하는 과정은
    - MCU에 맞는 제조사 라이브러리를 찾고 설치
    - 하드웨어 제어용 코드를 작성
    - 어플리케이션 코드를 작성
    - 컴파일러로 바이너리 코드로 변환
    - 다운로더 프로그램으로 보드에 바이너리 코드 올림
    - 보드 내의 부트로드가 바이너리 코드를 받아서 실행
        
        ⇒ MCU가 바뀌면 다시 처음부터 설정해야함!
        

- 하지만 아두이노는
    - 위의 과정을 한 번에 자동으로 처리해주는 ‘아두이노 IDE’를 제공함.
    - 하드웨어 제어 API가 있어서 MCU가 달라고 코드 거의 재사용 가능함!
    - 빌드(컴파일), 다운로드, 실행이 IDE 버튼으로 해결됨
    - 부트로더, 다운로더, 라이브러리 관리를 IDE가 다 해줌

- 만약 아두이노가 공식 지원하지 않는 보드를 아두이노에서 사용하려면
    - 해당 보드를 위한 보드 패키지, API 포팅, 부트로더 직접 설정
    - https://github.com/arduino/ArduinoCore-API/tree/master/api
    - 설정이 완료되면 이 보드도 아두이노 IDE에서 사용할 수 있음!

### 아두이노 소비전력 측정

- 소비전력 측정
    - 전력(W) = 전압(V) × 전류(A)
    - 배터리로 오랫동안 구동해야 하는 프로젝트라면 아두이노가 얼마나 전기를 쓰는지 알아야 함.
    - 전압(V)는 기능 및 사양에 나와있으므로 전류(A)만 알면 전력(W)를 알 수 있음.
    - Idle Current: 아무 작업도 하지 않을 때의 소비 전류. 이 것을 줄이면 대기 상태에서도 전기 소모를 줄일 수 있음.

- 측정 방법
    1. USB 케이블을 개조해서 측정 도구를 만들었음.
        
        : 일반 USB 선을 자르지 않고 암-수 USB 커넥터를 Pin to Pin으로 연결해서 측정기처럼 사용. 전압(VCC) 라인은 분리해서 전류계를 그 사이에 연결함으로써 전류만 측정 가능하게 함.
        
    2. 아두이노에 아무 코드도 없는 빈 스케치를 올렸음.
        
        : Idle 상태를 만들어서 측정.
        
    3. 이 상태에서 멀티미터나 전류계로 전류를 측정함.

- 측정 결과
    - 모조품 Arduino UNO R3 (5.08V 전원) → 약 64.3 mA
    - 모조품 Arduino UNO R3 (4.0V 배터리 사용) → 약 42.0 mA
        
        : 1V 정도 전압이 낮아졌을 뿐인데 전류가 약 3분의 2로 감소함
        
    - ATtiny13A (1 MHz, 단품) → 약 4~5mA
        
        : 아주 적은 전력만 사용함. LED, USB, 다른 회로가 없기 때문
        
    - WeMos D1 Mini (WiFi On)
        
        : 내부에서 3.3V로 변환하므로 차이가 영향 없음
        
- 같은 보드라 하더라도 제조사나 회로 배치에 따라 전력 소비가 다름. 어떤 부품을 쓰는지, LED가 얼마나 밝은지 등도 영향을 줌.
- CH340G 칩이 있는 보드는 전압이 낮아지면 전류도 확 줄어듦. 이 칩은 일정 전압 이하에서는 아예 작동을 멈추는 것 같음. 그만큼 전기도 안 씀.
- 보드에 불필요한 회로나 LED가 없으면 전기 소모가 훨씬 적음.

### 아두이노 데이터 로거

- 데이터 로거
    - 시간에 따라 센서 등의 데이터를 계속 기록하는 장치
    - 측정한 값을 파일로 저장해서 나중에 분석할 수 있도록 로깅

- 데이터 로거 동작 방법
    - 아두이노 UNO + SD 카드 모듈을 이용해서
        - 아날로그 입력값(전압)을 주기적으로 측정하고,
        - 그 값을 SD 카드에 기록하는 장치를 만듦.

- 코드 설명
    
    ```cpp
    #include <SD.h>
    const int chipSelect = 10;  // SD카드의 CS 핀
    File dataFile;
    
    void setup() 
    {
      Serial.begin(57600);  // 시리얼 통신 시작
      pinMode(SS, OUTPUT);  // SPI 통신용 설정
    
      if (!SD.begin(chipSelect)) 
      {
        Serial.println("SD 카드 인식 실패!");
        while (1);  // 더 이상 실행하지 않음
      }
    
      // "LOGGER00.TXT", "LOGGER01.TXT", ... 처럼 파일 이름 자동 생성
      char filename[] = "LOGGER00.TXT";
      for (uint8_t i = 0; i < 100; i++) 
      {
        filename[6] = i/10 + '0';
        filename[7] = i%10 + '0';
        if (! SD.exists(filename)) 
        {
          dataFile = SD.open(filename, FILE_WRITE);
          break;
        }
      }
    
      Serial.print("기록할 파일: ");
      Serial.println(filename);
    }
    
    void loop() 
    {
      String dataString = "";
      for (int analogPin = 0; analogPin < 3; analogPin++) // 센서값 읽기
      {
        int sensor = analogRead(analogPin);  // 정수로 변환
        dataString += String(sensor);  // 문자열로 저장
        
        if (analogPin < 2) {
    	    dataString += ",";
    	  }
      }
    
      Serial.println(dataString);       // 시리얼 출력
      dataFile.println(dataString);     // SD카드에 저장
      dataFile.flush();                 // 데이터 저장을 강제로 완료
      delay(10000);  // 10초 대기
    }
    ```
    
    1. 3개의 analogPin(A0, A1, A2)에서 센서 값을 읽음
    2. 이 값들은 전압(0~5V)을 정수 값으로 변환한 결과 (예: `503`, `728` 등)
    3. 10초마다 이 값을 CSV 형식(`503,728,612`)으로 만들어서
    4. SD 카드에 새로운 파일을 자동 생성하고 그 안에 한 줄씩 저장

- 데이터 로거 추가 내용
    - 예전에 배터리 전압을 수동으로 측정했던 것보다 훨씬 편하고 정밀함.
    - SD 모듈이 없어도 MicroSD 어댑터로 원시적으로 만들 수도 있음.

### 아두이노 데이터 전송

- HC-06은 아두이노에서 시리얼 통신을 이용하여 데이터 값을 주고 받을 수 있는 모듈. 10m 정도에서 무선으로 데이터 송수신이 가능함. (HC-06 모듈은 아이폰에서 사용이 불가능 함)

- HC-06을 연결해 시리얼 모니터로 AT 명령어 확인하기
    
    <aside>
    
    1. 준비물
        
        : 아두이노 우노 보드(SMD), 브레드보드 400홀 (불투명), HC-06 블루투스 모듈, 점퍼케이블, LED, 저항
        
    2. 아두이노와 연결
        
        ![image.png](attachment:0529088f-bce6-4bf6-9b54-bb06d788eaf8:image.png)
        
        ![image.png](attachment:0f29ccc2-daa4-4b56-b199-dd049ec631c2:image.png)
        
        [참고] TXD, RXD 연결 시 아두이노와 블루투스 모듈을 반대로 연결해야함. 코드에서 입력한 RX, TX 핀 번호는 아두이노 핀 번호이며, 아두이노의 RX핀은 블루투스 모듈의 TX에 연결하고, 아두이노의 TX핀은 블루투스 모듈의 RX에 연결.
        
    3. 코드 업로드
        
        ```cpp
        #include <SoftwareSerial.h>
        
        #define BT_RXD 8
        #define BT_TXD 7
        SoftwareSerial bluetooth(BT_RXD, BT_TXD);
        
        void setup() 
        {
        	Serial.begin(9600);
        	bluetooth.begin(9600);
        }
        
        void loop() 
        {
        	if (bluetooth.available()) {
        		Serial.write(bluetooth.read());
        	}
        	if (Seriial.available()) {
        		bluetooth.write(Serial.read());
        	}
        }
        ```
        
    4. 센서 테스트
        
        ![image.png](attachment:211e43aa-d67d-4817-9768-6036c20fd628:image.png)
        
        시리얼 모니터에서 ‘AT’ 입력하면 ‘OK’가 올라옴
        
        [참고] 아두이노 시리얼 모니터에서 AT Command
        
    </aside>
    

- 스마트폰 어플과 블루투스 통신
    - 동일한 소스코드 사용
    - 스마트폰 어플 스토어에서 ‘Arduino Bluetooth Controller’ 설치
        - 장치검색을 하면 HC-06이 검색된다.
        - 해당 디바이스의 PIN을 입력하세요: 초기 PIN 번호는 1234
        - 연결모드 선택: Terminal mode → HC-06의 LED가 켜진상태로 유지
        - 앱에서 문자열 입력후 전송 → 아두이노 시리얼 모니터 출력
    
- 블루투스를 이용하여 LED 제어
    
    <aside>
    
    1. 아두이노 연결
        
        ![image.png](attachment:3cfcb802-18cc-4a98-9630-9e20d00439df:image.png)
        
    2. 코드 업로드
        
        ```cpp
        # include <SoftwareSerialh>
        
        SoftwareSerial bluetooth(8, 9); //8번 TX, 9번 RX
        
        void setup()
        {
        	Serial.begin(9600);
        	bluetooth.begin(9600);
        	
        	pinMode(3, OUTPUT); // LED OURPUT
        	pinMode(5, OUTPUT); // LED OURPUT
        }
        
        void loop()
        {
        	char val = bluetooth.read();
        	
        	if (bluetooth.available()) {
        		Serial.write(bluetooth.read());
        	}
        	
        	if (val == 'a') {
        		digitalWrite(3, HIGHT);
        	}
        	if (val == 'b') {
        		digitalWrite(5, HIGHT);
        	}
        	else if (val == 'c') {
        		digitalWrite(3, LOW);
        		digitalWrite(5, LOW);
        	}
        }
        ```
        
    3. 센서 테스트
        - 장치검색을 하면 HC-06이 검색된다.
        - 해당 디바이스의 PIN을 입력하세요: 초기 PIN 번호는 1234
        - Terminal mode
            - 어플에서 ‘a’ 입력 → 아두이노에서 파란색 LED 점등
            - 어플에서 ‘b’ 입력 → 아두이노에서 빨간색 LED 점등
            - 어플에서 ‘c’ 입력 → 아두이노에서 파란색, 빨간색 LED 소등
    </aside>
    

### 아두이노 시리얼 연결

- 아두이노 보드와 PC(또는 다른 장치) 간의 데이터 통신 방식
- 시리얼(serial)은 데이터를 한 비트씩 순차적으로 전송하는 통신 방식
- 아두이노에서는 주로 `Serial.begin()`, `Serial.print()` 등을 사용해서 시리얼 통신 구현
- 목적
    - 디버깅용으로 데이터를 시리얼 모니터에 출력
    - 센서값 전송, 명령 수신 등 아두이노 ↔ PC 간 실시간 데이터 송수신
- 물리적 연결 방법
    - 보통은 USB 케이블을 통한 시리얼 연결
    - 또는 TX/RX 핀(하드웨어 시리얼)을 이용한 직접 연결 (예: 다른 MCU나 블루투스 모듈과 통신 시)

### 아두이노  USB 연결

- 아두이노 보드를 USB 케이블로 컴퓨터에 연결하는 행위
- 일반적으로 USB-B(UNO 등), Micro USB, USB-C 타입 포트를 사용함
- 목적
    - 전원 공급: 컴퓨터의 USB 포트를 통해 아두이노에 전기가 공급됨
    - 펌웨어 업로드: 우리가 만든 프로그램(코드)을 아두이노에 전송
    - 시리얼 통신 경로 제공: 아두이노 ↔ PC 간 데이터 주고받는 통로 제공
- 대부분의 아두이노 보드는 USB 연결 시 자동으로 시리얼 통신이 함께 설정됨
- 내부적으로는 USB to Serial 변환 칩(예: CH340, FT232, Atmega16U2 등)이 작동